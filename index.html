<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #16a34a;
            --error-color: #dc2626;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #1f2937;
        }

        .app-container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Ba≈ülƒ±q Hiss…ôsi */
        .header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 { margin: 0; font-size: 1.5rem; color: var(--primary-color); }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #1d4ed8; }

        .btn-check { background-color: var(--success-color); color: white; width: 100%; margin-top: 20px; font-size: 1.1rem; }
        
        /* Sual Kartlarƒ± */
        .question-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border-left: 5px solid transparent;
        }

        .q-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; line-height: 1.5; }

        .options-grid { display: flex; flex-direction: column; gap: 10px; }

        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-label:hover { background-color: #f9fafb; border-color: #d1d5db; }
        
        /* Se√ßil…ôn zaman stil */
        .option-label:has(input:checked) {
            border-color: var(--primary-color);
            background-color: #eff6ff;
        }

        input[type="radio"] {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            accent-color: var(--primary-color);
        }

        /* N…ôtic…ô Stijl…ôrƒ± */
        .correct-style {
            background-color: #dcfce7 !important;
            border-color: var(--success-color) !important;
            color: #14532d;
        }

        .wrong-style {
            background-color: #fee2e2 !important;
            border-color: var(--error-color) !important;
            color: #7f1d1d;
        }

        .status-badge {
            display: inline-block;
            margin-left: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Y√ºkl…ôm…ô v…ô X…ôta */
        #loader { text-align: center; padding: 40px; font-size: 1.2rem; color: #6b7280; }
        #error-box { background: #fee2e2; color: #991b1b; padding: 15px; border-radius: 8px; display: none; margin-bottom: 20px; }
        #result-summary { 
            text-align: center; 
            background: #1f2937; 
            color: white; 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 30px; 
            display: none; 
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>Quizimsi</h1>
        <button class="btn btn-primary" onclick="app.restart()">üîÑ Yenil…ô</button>
    </div>

    <div id="error-box"></div>
    <div id="loader">Suallar y√ºkl…ônir...</div>

    <div id="quiz-area" style="display: none;">
        <div id="questions-wrapper"></div>
        <button class="btn btn-check" onclick="app.submitQuiz()">N…ôtic…ôni Yoxla</button>
    </div>

    <div id="result-summary"></div>
</div>

<script>
    // Konfiqurasiya
    const CONFIG = {
        fileName: "AICVBLAR(Sheet1).csv",
        questionCount: 50 // Ne√ß…ô sual g√∂st…ôrilsin
    };

    class QuizApp {
        constructor() {
            this.allQuestions = [];
            this.currentQuestions = [];
            this.ui = {
                loader: document.getElementById('loader'),
                quizArea: document.getElementById('quiz-area'),
                wrapper: document.getElementById('questions-wrapper'),
                errorBox: document.getElementById('error-box'),
                resultBox: document.getElementById('result-summary'),
                submitBtn: document.querySelector('.btn-check')
            };
        }

        // 1. Proqramƒ± i≈ü…ô salan metod
        init() {
            this.fetchData();
        }

        // 2. CSV Faylƒ±nƒ± y√ºkl…ôy…ôn metod
        fetchData() {
            Papa.parse(CONFIG.fileName, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    if (results.data && results.data.length > 0) {
                        this.processData(results.data);
                    } else {
                        this.showError("CSV faylƒ± bo≈üdur v…ô ya oxuna bilm…ôdi.");
                    }
                },
                error: (err) => {
                    this.showError("Fayl tapƒ±lmadƒ±! Adƒ±n 'AICVBLAR(Sheet1).csv' olduƒüuna …ômin olun.");
                }
            });
        }

        // 3. M…ôlumatlarƒ± T…ômizl…ôy…ôn v…ô Hazƒ±rlayan (∆èN VACƒ∞B Hƒ∞SS∆è)
        processData(rawData) {
            // Burada biz g…ôl…ôn m…ôlumatƒ± "t…ômizl…ôyirik" ki, bo≈üluq (space) problemi qalmasƒ±n
            this.allQuestions = rawData
                .filter(row => row.Sual && row["Dogru cavab"]) // Bo≈ü s…ôtirl…ôri at
                .map(row => {
                    return {
                        question: row.Sual.trim(),
                        // Doƒüru cavabƒ± h…ômi≈ü…ô b√∂y√ºk h…ôrf…ô √ßeviririk v…ô bo≈üluqlarƒ± silirik (m…ôs: " a " -> "A")
                        correctKey: row["Dogru cavab"].trim().toUpperCase(),
                        options: [
                            { key: 'A', text: row.A },
                            { key: 'B', text: row.B },
                            { key: 'C', text: row.C },
                            { key: 'D', text: row.D }
                        ].filter(opt => opt.text && opt.text.trim() !== "") // Bo≈ü variantlarƒ± sil
                    };
                });

            this.startNewQuiz();
        }

        // 4. Yeni Quiz ba≈ülatmaq
        startNewQuiz() {
            this.ui.loader.style.display = 'none';
            this.ui.quizArea.style.display = 'block';
            this.ui.resultBox.style.display = 'none';
            this.ui.submitBtn.style.display = 'block';
            this.ui.errorBox.style.display = 'none';

            // Suallarƒ± qarƒ±≈üdƒ±r v…ô ilk 50-ni g√∂t√ºr
            this.currentQuestions = this.shuffle(this.allQuestions).slice(0, CONFIG.questionCount);
            this.renderQuestions();
        }

        // 5. Suallarƒ± Ekrana √áƒ±xarmaq
        renderQuestions() {
            this.ui.wrapper.innerHTML = ''; // K√∂hn…ôl…ôri t…ômizl…ô

            this.currentQuestions.forEach((q, index) => {
                // Variantlarƒ± qarƒ±≈üdƒ±rƒ±rƒ±q (amma Key "A", "B" olduƒüu kimi qalƒ±r)
                const shuffledOptions = this.shuffle([...q.options]);

                const card = document.createElement('div');
                card.className = 'question-card';
                card.dataset.index = index; // Hansƒ± sual olduƒüunu bilm…ôk √º√ß√ºn

                let optionsHTML = shuffledOptions.map(opt => `
                    <label class="option-label">
                        <input type="radio" name="q_${index}" value="${opt.key}">
                        <span>${opt.text}</span>
                    </label>
                `).join('');

                card.innerHTML = `
                    <div class="q-title">${index + 1}. ${q.question}</div>
                    <div class="options-grid">${optionsHTML}</div>
                `;

                this.ui.wrapper.appendChild(card);
            });
        }

        // 6. N…ôtic…ôni Yoxlamaq (Logic)
        submitQuiz() {
            let score = 0;
            const cards = document.querySelectorAll('.question-card');

            cards.forEach(card => {
                const index = card.dataset.index;
                const questionData = this.currentQuestions[index];
                const selectedInput = card.querySelector('input:checked');
                const allLabels = card.querySelectorAll('.option-label');

                // Dizaynƒ± sƒ±fƒ±rla
                allLabels.forEach(l => l.classList.remove('correct-style', 'wrong-style'));

                let userSelectedKey = selectedInput ? selectedInput.value : null;
                let isCorrect = false;

                // M√úQAYƒ∞S∆è: Se√ßil…ôn H…ôrf (A) === Doƒüru H…ôrf (A) ?
                if (userSelectedKey === questionData.correctKey) {
                    score++;
                    isCorrect = true;
                    if (selectedInput) selectedInput.parentElement.classList.add('correct-style');
                } else {
                    if (selectedInput) selectedInput.parentElement.classList.add('wrong-style');
                }

                // S…ôhvdirs…ô v…ô ya bo≈üdursa, doƒürunu g√∂st…ôr
                if (!isCorrect) {
                    // Doƒüru variantƒ± tapƒ±b ya≈üƒ±llayƒ±rƒ±q
                    const correctInput = card.querySelector(`input[value="${questionData.correctKey}"]`);
                    if (correctInput) {
                        correctInput.parentElement.classList.add('correct-style');
                        
                        // "Doƒüru" yazƒ±sƒ± …ôlav…ô et (…ôg…ôr yoxdursa)
                        if (!correctInput.parentElement.querySelector('.status-badge')) {
                            const badge = document.createElement('span');
                            badge.className = 'status-badge';
                            badge.innerText = "‚úî Doƒüru cavab";
                            correctInput.parentElement.appendChild(badge);
                        }
                    }
                }
            });

            // N…ôtic…ôni g√∂st…ôr
            this.ui.resultBox.innerHTML = `<h2>N…ôtic…ô: ${score} / ${this.currentQuestions.length}</h2>`;
            this.ui.resultBox.style.display = 'block';
            this.ui.submitBtn.style.display = 'none';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // K√∂m…ôk√ßi funksiya: Qarƒ±≈üdƒ±rma
        shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        showError(msg) {
            this.ui.loader.style.display = 'none';
            this.ui.errorBox.innerText = "X∆èTA: " + msg;
            this.ui.errorBox.style.display = 'block';
        }

        restart() {
            if (confirm("Yenid…ôn ba≈ülamaq ist…ôyirsiniz?")) {
                this.startNewQuiz();
                window.scrollTo(0,0);
            }
        }
    }

    // T…ôtbiqi ba≈ülat
    const app = new QuizApp();
    window.onload = () => app.init();

</script>

</body>
</html>

