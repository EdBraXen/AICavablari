<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sƒ±naq ƒ∞mtahanƒ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #4a90e2; --success: #28a745; --error: #dc3545; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        h1 { margin: 0; color: #333; font-size: 20px; }
        .refresh-btn { background-color: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .question-card { background: #fff; border: 1px solid #e1e4e8; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .question-text { font-weight: 600; font-size: 18px; margin-bottom: 15px; color: #2c3e50; }
        .options-list { list-style-type: none; padding: 0; }
        
        /* D√úZ∆èLƒ∞≈û EDƒ∞L∆èN Hƒ∞SS∆è: CSS */
        .options-list li { 
            margin-bottom: 10px; 
            border-radius: 6px; 
            background: #f1f3f5; 
            border: 2px solid transparent; 
            overflow: hidden; /* Kenardan da≈ümalarƒ±n qar≈üƒ±sƒ±nƒ± alƒ±r */
        }
        
        /* Label b√ºt√ºn sah…ôni tutmalƒ±dƒ±r ki, qutunun h…ôr yeri klikl…ônsin */
        .options-list li label {
            display: flex;
            align-items: center; /* Yazƒ±nƒ± v…ô d√ºym…ôni m…ôrk…ôzl…ô≈üdirir */
            padding: 12px 15px;
            width: 100%;
            height: 100%;
            cursor: pointer;
            box-sizing: border-box; /* Padding √∂l√ß√ºn√º pozmasƒ±n */
        }

        .options-list li label input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2); /* D√ºym…ôni bir az b√∂y√ºtd√ºk */
            cursor: pointer;
        }

        .options-list li:hover {
            background-color: #e2e6ea;
        }

        /* Se√ßil…ônd…ô avtomatik r…ông d…ôyi≈üimi (…ôlav…ô effekt) */
        .options-list li:has(input:checked) {
            background-color: #dbeafe;
            border-color: var(--primary);
        }

        .correct-answer { background-color: #d4edda !important; border-color: var(--success) !important; color: #155724; }
        .wrong-answer { background-color: #f8d7da !important; border-color: var(--error) !important; color: #721c24; }
        
        .submit-btn { display: block; width: 100%; padding: 15px; background-color: var(--success); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .result-box { text-align: center; padding: 20px; background: #343a40; color: white; border-radius: 8px; margin-top: 20px; display: none; }
        .loading { text-align: center; font-size: 1.2em; color: #666; padding: 20px; }
        .error-msg { color: red; font-weight: bold; text-align: center; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 id="quizTitle">Quiz Sistemi</h1>
        <button class="refresh-btn" onclick="startQuiz()">üîÑ Yeni 50 Sual</button>
    </header>

    <div id="loadingMsg" class="loading">Suallar fayldan y√ºkl…ônir...</div>
    <div id="errorDisplay" class="error-msg"></div>

    <div id="quizContainer" style="display:none;">
        <div id="questionsList"></div>
        <button class="submit-btn" onclick="checkResults()">N…ôtic…ôni G√∂st…ôr</button>
    </div>

    <div id="resultBox" class="result-box"></div>
</div>

<script>
    // FAYLIN ADI
    const csvFileName = "AICVBLAR(Sheet1).csv";
    
    let allQuestionsRaw = [];

    window.onload = function() {
        fetchData();
    };

    function fetchData() {
        fetch(csvFileName)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Fayl tapƒ±lmadƒ±! Adƒ±n "${csvFileName}" olduƒüuna …ômin olun.`);
                }
                return response.text();
            })
            .then(csvText => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    transformHeader: h => h.trim(),
                    complete: function(results) {
                        processData(results);
                    }
                });
            })
            .catch(error => {
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('errorDisplay').innerText = "X∆èTA: " + error.message;
            });
    }

    function processData(results) {
        const required = ["Sual", "A", "B", "C", "D", "Dogru cavab"];
        const missing = required.filter(field => !results.meta.fields.includes(field));

        if (missing.length > 0) {
            document.getElementById('loadingMsg').style.display = 'none';
            document.getElementById('errorDisplay').innerText = `X∆èTA: CSV s√ºtunlarƒ± √ßatmƒ±r: ${missing.join(", ")}`;
            return;
        }

        allQuestionsRaw = results.data.filter(item => item.Sual && item["Dogru cavab"]);
        
        if (allQuestionsRaw.length > 0) {
            document.getElementById('loadingMsg').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            renderQuiz();
        } else {
            document.getElementById('loadingMsg').innerText = "Faylda sual tapƒ±lmadƒ±.";
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function renderQuiz() {
        const list = document.getElementById('questionsList');
        list.innerHTML = '';
        document.getElementById('resultBox').style.display = 'none';
        document.querySelector('.submit-btn').style.display = 'block';

        let shuffledSelection = shuffleArray([...allQuestionsRaw]).slice(0, 50);
        
        document.getElementById('quizTitle').innerText = `Quiz (${shuffledSelection.length} sual)`;

        shuffledSelection.forEach((q, index) => {
            let correctLetter = q["Dogru cavab"].trim().toUpperCase();
            let correctText = q[correctLetter] ? q[correctLetter].trim() : "";

            let options = [q.A, q.B, q.C, q.D].filter(o => o && o.trim() !== "");
            options = shuffleArray(options);

            const card = document.createElement('div');
            card.className = 'question-card';
            card.dataset.correct = correctText; 

            let optionsHtml = '';
            options.forEach((opt) => {
                let safeValue = opt.replace(/"/g, '&quot;');
                // D√úZ∆èLƒ∞≈û: label-i li-nin tam i√ßin…ô oturtduq v…ô input-u d√ºzg√ºn yerl…ô≈üdirdik
                optionsHtml += `
                    <li>
                        <label>
                            <input type="radio" name="question_${index}" value="${safeValue}">
                            <span>${opt}</span>
                        </label>
                    </li>
                `;
            });

            card.innerHTML = `
                <div class="question-text">${index + 1}. ${q.Sual}</div>
                <ul class="options-list">${optionsHtml}</ul>
            `;
            list.appendChild(card);
        });
    }

    function checkResults() {
        const cards = document.querySelectorAll('.question-card');
        let correctCount = 0;
        let total = cards.length;

        cards.forEach(card => {
            const correctAnswerText = card.dataset.correct;
            const selectedOption = card.querySelector('input[type="radio"]:checked');
            const listItems = card.querySelectorAll('li');
            
            listItems.forEach(li => li.classList.remove('correct-answer', 'wrong-answer'));

            let isCorrect = false;
            if (selectedOption) {
                if (selectedOption.value === correctAnswerText) {
                    correctCount++;
                    isCorrect = true;
                    selectedOption.closest('li').classList.add('correct-answer');
                } else {
                    selectedOption.closest('li').classList.add('wrong-answer');
                }
            }

            if (!isCorrect) {
                listItems.forEach(li => {
                    // D√ºzg√ºn cavabƒ± tapmaq √º√ß√ºn input-un d…ôy…ôrini yoxlayƒ±rƒ±q (texti yox, value-nu)
                    const input = li.querySelector('input');
                    if (input && input.value === correctAnswerText) {
                        li.classList.add('correct-answer');
                        // Doƒüru i≈üar…ôsini label-in i√ßin…ô …ôlav…ô edirik ki, s√ºr√º≈üm…ôsin
                        const labelSpan = li.querySelector('label span');
                        if(labelSpan) labelSpan.innerHTML += ' <b>(‚úî Doƒüru)</b>';
                    }
                });
            }
        });

        const scoreBox = document.getElementById('resultBox');
        scoreBox.style.display = 'block';
        scoreBox.innerHTML = `<h2>Yekun Bal: ${correctCount} / ${total}</h2>`;
        document.querySelector('.submit-btn').style.display = 'none';
        window.scrollTo(0, document.body.scrollHeight);
    }

    function startQuiz() {
        if(confirm("Yeni suallar y√ºkl…ônsin?")) {
            renderQuiz();
            window.scrollTo(0, 0);
        }
    }
</script>

</body>
</html>
